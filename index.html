<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏£‡∏ñ</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    :root { --primary-blue: #0d6efd; --bg-gray: #f0f2f5; }
    body { background-color: var(--bg-gray); font-family: 'Prompt', sans-serif; }
    .app-container { max-width: 480px; margin: auto; min-height: 100vh; background: white; box-shadow: 0 0 20px rgba(0,0,0,0.05); }
    .app-header { background: var(--primary-blue); color: white; padding: 30px 20px; border-bottom-left-radius: 30px; border-bottom-right-radius: 30px; text-align: center; margin-bottom: 25px; }
    .form-section { padding: 0 20px 30px 20px; }
    .form-control, .form-select { border-radius: 12px; padding: 12px 15px; margin-bottom: 5px; }
    .farmer-info-card { background: #f8faff; border: 1px dashed #0d6efd; border-radius: 15px; padding: 15px; margin: 20px 0; }
    .info-item { display: flex; justify-content: space-between; margin-bottom: 8px; border-bottom: 1px solid #edf2f7; padding-bottom: 5px; }
    .info-label { color: #718096; font-size: 0.85rem; }
    .info-value { font-weight: 600; color: #2d3748; }
    .btn-submit { border-radius: 15px; padding: 16px; font-weight: 600; background: var(--primary-blue); border: none; box-shadow: 0 4px 12px rgba(13,110,253,0.3); }
    #loader { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); z-index: 10000; justify-content: center; align-items: center; flex-direction: column; }
  </style>
</head>
<body>

  <div id="loader">
    <div class="spinner-grow text-primary" style="width: 3rem; height: 3rem;"></div>
    <p class="mt-3 fw-bold text-primary">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...</p>
  </div>

  <div class="app-container">
    <div class="app-header shadow">
      <h3 class="mb-1">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏£‡∏ñ</h3>
      <p class="mb-0 opacity-75 small">‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ú‡πà‡∏≤‡∏ô GitHub</p>
    </div>

    <div class="form-section">
      <form id="bookingForm">
        <div class="mb-3">
          <label class="form-label">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤</label>
          <input type="date" id="dateInput" class="form-control" required>
        </div>

        <div class="mb-3">
          <label class="form-label">‚è∞ ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</label>
          <select id="timeslot" class="form-select"></select>
        </div>

        <div class="mb-3">
          <label class="form-label">üöõ ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ‡∏ö‡∏£‡∏£‡∏ó‡∏∏‡∏Å</label>
          <select id="carTypeSelect" class="form-select" onchange="toggleTrailer()">
            <option value="‡∏™‡∏¥‡∏ö‡∏•‡πâ‡∏≠">‡∏™‡∏¥‡∏ö‡∏•‡πâ‡∏≠</option>
            <option value="‡∏´‡∏Å‡∏•‡πâ‡∏≠">‡∏´‡∏Å‡∏•‡πâ‡∏≠</option>
            <option value="‡πÅ‡∏°‡πà‡∏û‡πà‡∏ß‡∏á‡πÅ‡∏•‡∏∞‡∏•‡∏π‡∏Å‡∏û‡πà‡∏ß‡∏á">‡πÅ‡∏°‡πà‡∏û‡πà‡∏ß‡∏á‡πÅ‡∏•‡∏∞‡∏•‡∏π‡∏Å‡∏û‡πà‡∏ß‡∏á</option>
            <option value="‡∏≠‡∏µ‡πÅ‡∏ï‡πã‡∏ô">‡∏≠‡∏µ‡πÅ‡∏ï‡πã‡∏ô</option>
            <option value="‡πÄ‡∏ó‡∏£‡∏•‡πÄ‡∏•‡∏≠‡∏£‡πå">‡πÄ‡∏ó‡∏£‡∏•‡πÄ‡∏•‡∏≠‡∏£‡πå</option>
          </select>
        </div>

        <div class="row g-2 mb-3">
          <div class="col-12">
            <label class="form-label">üÜî ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ</label>
            <input type="text" id="plate" class="form-control" placeholder="89-1617 ‡∏ô‡∏°" required>
          </div>
          <div class="col-12" id="divTrailer" style="display:none;">
            <label class="form-label text-danger">üÜî ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏•‡∏π‡∏Å‡∏û‡πà‡∏ß‡∏á</label>
            <input type="text" id="iTrailer" class="form-control" placeholder="89-1619 ‡∏ô‡∏°">
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">üî¢ ‡πÄ‡∏•‡∏Ç‡πÇ‡∏Ñ‡∏ß‡∏ï‡∏≤‡∏ä‡∏≤‡∏ß‡πÑ‡∏£‡πà</label>
          <input type="number" id="qInput" class="form-control form-control-lg border-primary" inputmode="numeric" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏•‡∏Ç‡πÇ‡∏Ñ‡∏ß‡∏ï‡∏≤ 8 ‡∏´‡∏•‡∏±‡∏Å" oninput="autoSearch()">
        </div>

        <div class="farmer-info-card">
          <div class="info-item"><span class="info-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏≤‡∏ß‡πÑ‡∏£‡πà</span><span class="info-value text-primary" id="vFarmer">-</span></div>
          <div class="info-item"><span class="info-label">‡∏ô‡∏±‡∏Å‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏î‡∏π‡πÅ‡∏•</span><span class="info-value" id="vOfficer">-</span></div>
          <div class="info-item" style="border:none;"><span class="info-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</span><span class="info-value text-success" id="vPhone">-</span></div>
        </div>

        <button type="submit" id="btnSubmit" class="btn btn-primary btn-submit w-100 mt-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß</button>
      </form>
    </div>
  </div>

  <script>
    // --- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL ‡∏Ç‡∏≠‡∏á Web App ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å Google Apps Script ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ---
    const SCRIPT_URL = "‡πÉ‡∏™‡πà_URL_WEB_APP_‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà"; 

    window.onload = () => {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('dateInput').value = today;
      const s = document.getElementById('timeslot');
      const slots = ["08:01 - 09:00", "09:01 - 10:00", "10:01 - 11:00", "11:01 - 12:00", "12:01 - 13:00", "13:01 - 14:00", "14:01 - 15:00", "15:01 - 16:00", "16:01 - 17:00", "17:01 - 18:00", "18:01 - 19:00", "19:01 - 20:00", "20:01 - 21:00", "21:01 - 22:00", "22:01 - 23:00", "23:01 - 00:00", "00:01 - 02:00", "02:01 - 03:00", "03:01 - 04:00", "04:01 - 05:00", "05:01 - 06:00", "06:01 - 07:00", "07:01 - 08:00"];
      slots.forEach(t => s.options.add(new Option(t, t)));
    };

    function toggleTrailer() {
      const isP = document.getElementById('carTypeSelect').value === '‡πÅ‡∏°‡πà‡∏û‡πà‡∏ß‡∏á‡πÅ‡∏•‡∏∞‡∏•‡∏π‡∏Å‡∏û‡πà‡∏ß‡∏á';
      document.getElementById('divTrailer').style.display = isP ? 'block' : 'none';
      document.getElementById('iTrailer').required = isP;
    }

    let timer;
    let farmerData = {};

    function autoSearch() {
      const q = document.getElementById('qInput').value;
      clearTimeout(timer);
      if(q.length < 5) return;
      
      document.getElementById('vFarmer').innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...";
      timer = setTimeout(async () => {
        try {
          const response = await fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify({ action: 'search', quota: q })
          });
          const res = await response.json();
          if(res.success) {
            document.getElementById('vFarmer').innerText = res.farmerName;
            document.getElementById('vOfficer').innerText = res.officerName;
            document.getElementById('vPhone').innerText = res.phone;
            farmerData = res;
          } else {
            document.getElementById('vFarmer').innerText = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
            farmerData = {};
          }
        } catch (e) { console.error(e); }
      }, 800);
    }

    document.getElementById('bookingForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      if(!farmerData.farmerName) {
        Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÇ‡∏Ñ‡∏ß‡∏ï‡∏≤‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'warning');
        return;
      }

      document.getElementById('loader').style.display = 'flex';
      const payload = {
        action: 'submit',
        date: document.getElementById('dateInput').value,
        timeslot: document.getElementById('timeslot').value,
        carType: document.getElementById('carTypeSelect').value,
        plate: document.getElementById('plate').value,
        trailerPlate: document.getElementById('iTrailer').value,
        quota: document.getElementById('qInput').value,
        farmerName: farmerData.farmerName,
        officerName: farmerData.officerName,
        phone: farmerData.phone
      };

      try {
        const response = await fetch(SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify(payload)
        });
        const res = await response.json();
        document.getElementById('loader').style.display = 'none';
        Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', res.message, 'success').then(() => location.reload());
      } catch (err) {
        document.getElementById('loader').style.display = 'none';
        Swal.fire('Error', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'error');
      }
    });
  </script>
</body>
</html>
