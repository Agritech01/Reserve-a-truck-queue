<!DOCTYPE html>
<html lang="th">
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#0d6efd">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
  <style>
    :root {
      --primary-blue: #0d6efd;
      --bg-gray: #f0f2f5;
    }
    body { 
      background-color: var(--bg-gray); 
      font-family: 'Prompt', sans-serif; 
      -webkit-tap-highlight-color: transparent;
    }
    /* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á Card ‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÅ‡∏≠‡∏õ */
    .app-container {
      max-width: 480px;
      margin: auto;
      min-height: 100vh;
      background: white;
      box-shadow: 0 0 20px rgba(0,0,0,0.05);
    }
    .app-header {
      background: var(--primary-blue);
      color: white;
      padding: 30px 20px;
      border-bottom-left-radius: 30px;
      border-bottom-right-radius: 30px;
      text-align: center;
      margin-bottom: 25px;
    }
    .form-section { padding: 0 20px 30px 20px; }
    
    /* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á Input ‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô */
    .form-control, .form-select {
      border-radius: 12px;
      padding: 12px 15px;
      border: 1px solid #dee2e6;
      font-size: 1rem;
      margin-bottom: 5px;
    }
    .form-control:focus {
      box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.15);
      border-color: var(--primary-blue);
    }
    .form-label {
      font-weight: 600;
      font-size: 0.85rem;
      color: #495057;
      margin-left: 5px;
      margin-bottom: 5px;
    }
    
    /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏≤‡∏ß‡πÑ‡∏£‡πà‡πÅ‡∏ö‡∏ö Modern */
    .farmer-info-card {
      background: #f8faff;
      border: 1px dashed #0d6efd;
      border-radius: 15px;
      padding: 15px;
      margin: 20px 0;
    }
    .info-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      border-bottom: 1px solid #edf2f7;
      padding-bottom: 5px;
    }
    .info-label { color: #718096; font-size: 0.85rem; }
    .info-value { font-weight: 600; color: #2d3748; }

    /* ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà */
    .btn-submit {
      border-radius: 15px;
      padding: 16px;
      font-size: 1.1rem;
      font-weight: 600;
      background: var(--primary-blue);
      border: none;
      box-shadow: 0 4px 12px rgba(13, 110, 253, 0.3);
      transition: all 0.2s;
    }
    .btn-submit:active { transform: scale(0.98); }

    /* Loader ‡πÅ‡∏ö‡∏ö‡∏ô‡∏∏‡πà‡∏°‡∏ô‡∏ß‡∏• */
    #loader {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(255,255,255,0.9); z-index: 10000;
      justify-content: center; align-items: center; flex-direction: column;
    }
  </style>
</head>
<body>

  <div id="loader">
    <div class="spinner-grow text-primary" style="width: 3rem; height: 3rem;"></div>
    <p class="mt-3 fw-bold text-primary">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
  </div>

  <div class="app-container">
    <div class="app-header shadow">
      <h3 class="mb-1">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏£‡∏ñ</h3>
      <p class="mb-0 opacity-75 small">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡πÄ‡∏Ç‡πâ‡∏≤‡∏•‡∏≤‡∏ô</p>
    </div>

    <div class="form-section">
      <form id="bookingForm">
        
        <div class="mb-3">
          <label class="form-label">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤</label>
          <input type="date" name="date" id="dateInput" class="form-control" required>
        </div>

        <div class="mb-3">
          <label class="form-label">‚è∞ ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</label>
          <select name="timeslot" id="timeslot" class="form-select"></select>
        </div>

        <div class="mb-3">
          <label class="form-label">üöõ ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ‡∏ö‡∏£‡∏£‡∏ó‡∏∏‡∏Å</label>
          <select name="carType" id="carTypeSelect" class="form-select" onchange="toggleTrailer()">
            <option value="‡∏™‡∏¥‡∏ö‡∏•‡πâ‡∏≠">‡∏™‡∏¥‡∏ö‡∏•‡πâ‡∏≠</option>
            <option value="‡∏´‡∏Å‡∏•‡πâ‡∏≠">‡∏´‡∏Å‡∏•‡πâ‡∏≠</option>
            <option value="‡πÅ‡∏°‡πà‡∏û‡πà‡∏ß‡∏á‡πÅ‡∏•‡∏∞‡∏•‡∏π‡∏Å‡∏û‡πà‡∏ß‡∏á">‡πÅ‡∏°‡πà‡∏û‡πà‡∏ß‡∏á‡πÅ‡∏•‡∏∞‡∏•‡∏π‡∏Å‡∏û‡πà‡∏ß‡∏á</option>
            <option value="‡∏≠‡∏µ‡πÅ‡∏ï‡πã‡∏ô">‡∏≠‡∏µ‡πÅ‡∏ï‡πã‡∏ô</option>
            <option value="‡πÄ‡∏ó‡∏£‡∏•‡πÄ‡∏•‡∏≠‡∏£‡πå">‡πÄ‡∏ó‡∏£‡∏•‡πÄ‡∏•‡∏≠‡∏£‡πå</option>
          </select>
        </div>

        <div class="row g-2 mb-3">
          <div class="col-12" id="mainPlateCol">
            <label class="form-label">üÜî ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ</label>
            <input type="text" name="plate" class="form-control" placeholder="89-1617 ‡∏ô‡∏°" required>
          </div>
          <div class="col-12" id="divTrailer" style="display:none;">
            <label class="form-label text-danger">üÜî ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏•‡∏π‡∏Å‡∏û‡πà‡∏ß‡∏á</label>
            <input type="text" name="trailerPlate" id="iTrailer" class="form-control" placeholder="89-1619 ‡∏ô‡∏°">
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">üî¢ ‡πÄ‡∏•‡∏Ç‡πÇ‡∏Ñ‡∏ß‡∏ï‡∏≤‡∏ä‡∏≤‡∏ß‡πÑ‡∏£‡πà</label>
          <input type="number" name="quota" id="qInput" class="form-control form-control-lg border-primary" 
                 inputmode="numeric" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏•‡∏Ç‡πÇ‡∏Ñ‡∏ß‡∏ï‡∏≤ 8 ‡∏´‡∏•‡∏±‡∏Å" oninput="autoSearch()" required>
        </div>

        <div class="farmer-info-card">
          <div class="info-item">
            <span class="info-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏≤‡∏ß‡πÑ‡∏£‡πà</span>
            <span class="info-value text-primary" id="vFarmer">-</span>
          </div>
          <div class="info-item">
            <span class="info-label">‡∏ô‡∏±‡∏Å‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏î‡∏π‡πÅ‡∏•</span>
            <span class="info-value" id="vOfficer">-</span>
          </div>
          <div class="info-item" style="border:none;">
            <span class="info-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ô‡∏±‡∏Å‡πÄ‡∏Å‡∏©‡∏ï‡∏£</span>
            <span class="info-value text-success" id="vPhone">-</span>
          </div>
          
          <input type="hidden" name="farmerName" id="hFarmer">
          <input type="hidden" name="officerName" id="hOfficer">
          <input type="hidden" name="phone" id="hPhone">
        </div>

        <button type="submit" id="btnSubmit" class="btn btn-primary btn-submit w-100 mt-2">
          ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß
        </button>
      </form>
    </div>
  </div>

  <script>
    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
    window.onload = () => {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('dateInput').min = today;
      document.getElementById('dateInput').value = today;
      
      const s = document.getElementById('timeslot');
      const slots = ["08:01 - 09:00", "09:01 - 10:00", "10:01 - 11:00", "11:01 - 12:00", "12:01 - 13:00", "13:01 - 14:00", "14:01 - 15:00", "15:01 - 16:00", "16:01 - 17:00", "17:01 - 18:00", "18:01 - 19:00", "19:01 - 20:00", "20:01 - 21:00", "21:01 - 22:00", "22:01 - 23:00", "23:01 - 00:00", "00:01 - 02:00", "02:01 - 03:00", "03:01 - 04:00", "04:01 - 05:00", "05:01 - 06:00", "06:01 - 07:00", "07:01 - 08:00"];
      slots.forEach(t => s.options.add(new Option(t, t)));
    };

    function toggleTrailer() {
      const isP = document.getElementById('carTypeSelect').value === '‡πÅ‡∏°‡πà‡∏û‡πà‡∏ß‡∏á‡πÅ‡∏•‡∏∞‡∏•‡∏π‡∏Å‡∏û‡πà‡∏ß‡∏á';
      document.getElementById('divTrailer').style.display = isP ? 'block' : 'none';
      document.getElementById('iTrailer').required = isP;
    }

    let timer;
    function autoSearch() {
      const q = document.getElementById('qInput').value;
      clearTimeout(timer);
      if(!q) { resetInfo(); return; }
      
      document.getElementById('vFarmer').innerHTML = '<span class="spinner-border spinner-border-sm"></span>';
      
      timer = setTimeout(() => {
        google.script.run.withSuccessHandler(res => {
          if(res && res.success) {
            document.getElementById('vFarmer').innerText = res.farmerName;
            document.getElementById('vOfficer').innerText = res.officerName;
            document.getElementById('vPhone').innerText = res.phone || "-";
            document.getElementById('hFarmer').value = res.farmerName;
            document.getElementById('hOfficer').value = res.officerName;
            document.getElementById('hPhone').value = res.phone || "-";
          } else {
            document.getElementById('vFarmer').innerText = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
            resetInfo();
          }
        }).getQuotaData(q);
      }, 800);
    }

    function resetInfo() {
      document.getElementById('vOfficer').innerText = "-";
      document.getElementById('vPhone').innerText = "-";
      document.getElementById('hFarmer').value = "";
    }

    document.getElementById('bookingForm').addEventListener('submit', function(e) {
      e.preventDefault();
      if(!document.getElementById('hFarmer').value) {
        Swal.fire({ icon: 'error', title: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÇ‡∏Ñ‡∏ß‡∏ï‡∏≤', text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏•‡∏Ç‡πÇ‡∏Ñ‡∏ß‡∏ï‡∏≤‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á' });
        return;
      }

      document.getElementById('loader').style.display = 'flex';
      document.getElementById('btnSubmit').disabled = true;

      google.script.run
        .withSuccessHandler(msg => {
          document.getElementById('loader').style.display = 'none';
          // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏∏‡∏î‡∏ô‡∏µ‡πâ: msg ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô String ‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
          Swal.fire({ 
            icon: msg.includes('‚úÖ') ? 'success' : 'error', 
            title: msg.includes('‚úÖ') ? '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' : '‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', 
            text: msg, 
            confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á' 
          })
          .then(() => {
             if(msg.includes('‚úÖ')) location.reload();
             else document.getElementById('btnSubmit').disabled = false;
          });
        })
        .withFailureHandler(err => {
          document.getElementById('loader').style.display = 'none';
          document.getElementById('btnSubmit').disabled = false;
          Swal.fire('Error', err.toString(), 'error');
        })
        .processForm(this);
    });
  </script>
</body>
</html>
